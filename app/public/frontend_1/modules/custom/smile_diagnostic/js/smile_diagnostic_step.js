(function($,Drupal,drupalSettings){Drupal.AjaxCommands.prototype.fieldTransitionCommand=function(ajax,response,status){Drupal.attachBehaviors();$(response.selector).ajaxFieldTransitionUp();$(response.target).ajaxFieldTransitionDown();$('html,body').animate({scrollTop:$('body').offset().top},'slow');};Drupal.AjaxCommands.prototype.scrollTopCommand=function(ajax,parameters){$('html,body').animate({scrollTop:$('body').offset().top},'slow');};Drupal.AjaxCommands.prototype.consoleLogCommand=function(ajax,parameters){console.log(parameters.data);};Drupal.AjaxCommands.prototype.trackerCCNCommand=function(ajax,parameters){try{var expression=sessionStorage.getItem('search_agreement_user_input');var data={'annuaire_branche_expression':!!expression?expression:parameters.data.input,'annuaire_branche_couverture':parameters.data.das,'annuaire_branche_college':parameters.data.college,'annuaire_branche_resultats':parameters.data.result,'annuaire_branche_meth':''};tC.event.recherche_ccn(this,data);}
catch(error){}};Drupal.AjaxCommands.prototype.trackerCommand=function(ajax,tracker){Drupal.attachBehaviors();try{tC.event.diagnostic_change_step(this,{"step_profile":tracker.step_profile,'step_name':tracker.step_name,});}
catch(error){console.error(error);}};Drupal.AjaxCommands.prototype.updateStepsCommand=function(ajax,response,status){Drupal.attachBehaviors();var diagnosticStepsBlock=$('#diagnostic-steps, #diagnostic-steps-mobile');var activeSteps=null;if(response.steps.steps_profil!=null){var html='';for(var category in response.steps.steps_profil){if(response.steps.steps_profil.hasOwnProperty(category)){if('steps_profil'in response.steps.categories&&category in response.steps.categories.steps_profil){if(response.steps.categories.steps_profil[category].title!=null){html+='<span class="category description">'+response.steps.categories.steps_profil[category].title+'</span>';}}
response.steps.steps_profil[category].forEach(function(field,i){var fieldId=Object.keys(field);var fieldTitle=field[fieldId];if(fieldTitle!=null){html+='<li data-field-id="'+fieldId+'">';html+='<span class="step">'+fieldTitle+'</span>';html+='</li>';}});}}
$('.steps-profil .steps-part li:not(.initial)',diagnosticStepsBlock).remove();$('.steps-profil .steps-part',diagnosticStepsBlock).append(html);activeSteps=$('.steps-profil',diagnosticStepsBlock);}
if(response.steps.steps_besoins!=null){var html='';for(var category in response.steps.steps_besoins){if(response.steps.steps_besoins.hasOwnProperty(category)){if(response.steps.steps_besoins[category]===true){continue;}
if('steps_besoins'in response.steps.categories&&category in response.steps.categories.steps_besoins){if(response.steps.categories.steps_besoins[category].title!=null){html+='<span class="category description">'+response.steps.categories.steps_besoins[category].title+'</span>';}}
html+='<ul>';response.steps.steps_besoins[category].forEach(function(field,i){var fieldId=Object.keys(field);var fieldTitle=field[fieldId];if(fieldTitle!=null){html+='<li data-field-id="'+fieldId+'">';html+='<span class="step">'+fieldTitle+'</span>';html+='</li>';}});html+='</ul>';}}
$('.steps-besoins .steps-part',diagnosticStepsBlock).html(html);activeSteps=$('.steps-besoins',diagnosticStepsBlock);$('.steps-profil').addClass('checked');}
if(response.steps.steps_branche!=null){activeSteps=$('.steps-branche',diagnosticStepsBlock);$('.steps-besoins').addClass('checked');}
if(activeSteps!=null){$('.steps-besoins, .steps-branche').removeClass('active-steps');activeSteps.addClass('active-steps');}};$.fn.ajaxFieldTransitionUp=function(){$(this).slideUp(350);};$.fn.ajaxFieldTransitionDown=function(){$(this).slideDown(350);};Drupal.behaviors.diagnostic={attach:function(context,settings){var timeDelay;$('input.form-radio.form-control:checked, input.form-checkbox.form-control:checked').each(function(){$(this).parent('.form-item').addClass('form-item-active');});$(context).keypress(function(event){var keyCode=(event.keyCode?event.keyCode:event.which);if(keyCode==='13'||keyCode===13){if(!$('#agreement-search-form').is(':focus')){$('input[type^="submit"].enter-key-event:visible:not(:disabled)',context).trigger('mousedown');}}});$('input[type=number]').once().on('input change propertychange',function(e){var $input=$(this);var value=$input.val();var hasError=false;var errorMessage="Le champ n'est pas valide";if(!!value&&value<$input.attr('min')){hasError=true;errorMessage="Le nombre de salariés doit être supérieur ou égal à 1";}
if(hasError){var $errors=$('.error-message',$input.parent());if($errors.length){$errors.html(errorMessage);}
else{$input.parent().append('<div class="error-message red-negative">'+errorMessage+'</div>');}
$input.parents('.form-wrapper').first().find('.form-submit').prop('disabled',true);}
else{$('.error-message',$input.parent()).remove();$input.parents('.form-wrapper').first().find('.form-submit').prop('disabled',false);}});$('input[name="code_postal"]').once().on('input change propertychange',function(e){var $input=$(this);var value=$input.val();var valueIsNum=/^\d+$/.test(value);var valueLength=value.length;var hasError=false;var errorMessage="Le champ n'est pas valide";if(!!value&&valueLength>2&&(!valueIsNum||valueLength!==5)){hasError=true;errorMessage="Le code postal doit être composé de 5 chiffres";}
if(!!value===false){hasError=true;errorMessage="";}
if(valueLength<3){hasError=true;errorMessage="";}
var $parent=$input.parents('.form-item-code-postal').first();var $wrapper=$input.parents('.form-wrapper').first();var $errors=$parent.siblings('.error-message');clearTimeout(timeDelay);timeDelay=setTimeout(function(){if(hasError){if($errors.length){$errors.html(errorMessage);}
else{$parent.after('<div class="error-message red-negative">'+errorMessage+'</div>');}
$('input[data-drupal-selector="edit-postal-code"]').prop('disabled',true);}
else{$errors.remove();$('input[data-drupal-selector="edit-postal-code"]').prop('disabled',false);}},500);});var diagnostic={diagnostic:'.diagnostic',card:'.diagnostic--profil--desktop--card',hoverCard:function(){$(this.card,context).each(function(){var classList=$(this).attr('class').split(/\s+/);var $this=$(this);$.each(classList,function(index,item){if(item.match('^hover-bg-')){var hoverColor=item.substring(6);$this.hover(function(){$(this).removeClass('bg-grey-light').addClass(hoverColor);},function(){$(this).addClass('bg-grey-light').removeClass(hoverColor);});}});});},step:function(){$(this.diagnostic,context).on('click','.next-step',function(e){e.preventDefault();});},etapierMobile:function(){var etapier=$('.block-flap').find('#container-etapier');if(etapier.length){var flap=etapier.parents('.block-flap');flap.addClass('flap-etapier');}},moreResultCCn:function(){$('#ccn-result-wrapper',context).on('click','.more-result-ccn-result',function(e){e.preventDefault();$(".form-item-ccn-result:hidden").each(function(index,element){if(index<10){$(this).show();}else{return false;}
index++});if($(".form-item-ccn-result:hidden").length==0){$(this).remove();}});},init:function(){this.hoverCard();this.step();this.etapierMobile();this.moreResultCCn()}}
diagnostic.init();}};Drupal.behaviors.diagnosticAction={attach:function(context,settings){if(window.matchMedia("(min-width: 769px)").matches){$('form[class^=diagnostic-form] div[id*="edit-niveau"] > div').once('clickTitle').on('click',function(e){var clickedElement=$(this);if(!$(clickedElement).hasClass('open')){$(clickedElement).addClass('open');$(clickedElement).siblings().removeClass('open');var fixedContent=$('#fixed-content');if(fixedContent.length){var destScroll=$('#fixed-content').offset().top-$('header').height();$('html, body').animate({scrollTop:destScroll},1000);}}
else if(!$(e.target).hasClass('nb-salaries-input')&&!$(e.target).hasClass('item')&&!$(e.target).hasClass('ccn-plugin-search')&&!$(e.target).hasClass('name')){$(clickedElement).removeClass('open');}});$(document).once().mousedown(function(e){if($(e.target).hasClass('option')||$(e.target).hasClass('nb-salaries-input')||$(e.target).hasClass('li-form-salarie')||$(e.target).hasClass('item')||$(e.target).hasClass('place-text')||$(e.target).hasClass('title')||$(e.target).hasClass('name')||$(e.target).is('strong')||$(e.target).hasClass('ccn-plugin-search')){}
else{$('form[class^=diagnostic-form] div[id*="edit-niveau"] > div').removeClass('open');}});}
if(window.matchMedia("(max-width: 768px)").matches){$('form[class^=diagnostic-form] div[id*="edit-niveau"]').on('click',function(){$('form[class^=diagnostic-form] div[id*="edit-niveau"] > div').attr('style','width:100%;');});$('form[class^=diagnostic-form]  > .js-form-item-code-postal').once('moveEnd').insertAfter('form[class^=diagnostic-form] div[id*="edit-niveau"]');if($('form[class^=diagnostic-form] div[id*="edit-niveau"] > div').hasClass('current-choice')){$('form[class^=diagnostic-form]').addClass('diag-open');}
else{$('form[class^=diagnostic-form]').removeClass('diag-open');}}
if($('[id^=edit-niveau] .choice-ok').length===3){$('[id^=edit-niveau] .choice-ok').addClass('show-score');$('form[class^=diagnostic-form]').addClass('show-score-container');}}};})(jQuery,Drupal,drupalSettings);