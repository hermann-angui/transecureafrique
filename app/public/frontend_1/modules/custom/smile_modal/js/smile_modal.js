if(!Array.prototype.last){Array.prototype.last=function(){return this[this.length-1];};};(function($,Drupal,drupalSettings){$(document).on('hide.bs.modal','.modal-video',function(e){var iframe=$('iframe');iframe.attr('src',iframe.attr('src'));});Drupal.AjaxCommands.prototype.modalInsertCommand=function(ajax,response,status){try{Drupal.flap.showContainer(response.content,response.size);Drupal.attachBehaviors($(Drupal.flap.flap_container+' .block-content').get(0));document.dispatchEvent(new CustomEvent('open_flap'));tC.event.flap_display(this,{'flap_id':response.id,'flap_name':response.title});}catch(e){console.error('problème lors de l\'envoi de flap_display'+e);}};Drupal.behaviors.flap={attach:function(context,settings){Drupal.flap.init(context);}};Drupal.flap={'breakpoint':'1024','flap_close':'.flap-close','flap_open':'.flap-open','flap_container':'.smile-customer-overlay .block-flap','animation_delay':300,'container_flap':[],'init':function(context){$('.chosen-container.select-target-switch-toolbox').once('flapSwitchToolbox').each(function(){$(this).closest('.form-type-select').find('select.select-target-switch-toolbox').chosen().change(function(){var value=$(this).closest('.form-type-select').find('select.select-target-switch-toolbox').val();$(this).parents('.smile-modal-switch-toolbox-form').find('#open-toolbox-'+value).trigger('click');});});$('.modal-link, a[modal="modal-link"]',context).once('link-add-data').each(function(){$(this).addClass('flap-open');$(this).addClass('use-ajax');$(this).parent('.field--field-pg-link, .advanced-link').addClass('container-flap-open');var parent=$(this).closest('.paragraph');if($('.modal--type--existing-panel .paragraph--type--existing-panel',parent).length){if(typeof $(this).data('flapajaxid')==='undefined'){this.dataset.flapajaxid=$('.modal--type--existing-panel .paragraph--type--existing-panel .node',parent).first().attr('id');}}
else if($('.paragraph--type--pg-panel',parent).length){this.dataset.flap_open=$('.paragraph--type--pg-panel',parent).first().attr('id');}});$('.container-flap-open '+Drupal.flap.flap_open,context).once('flap-bind-click').each(function(){$(this).on("click",function(e){e.preventDefault();var flapajaxid;if($(e.target).is('a')){flapajaxid=$(e.target).data('flapajaxid');}
else{flapajaxid=$(e.target).closest('a').data('flapajaxid');}
if(flapajaxid){$('#'+flapajaxid).find('a.flap-open-ajax-link').trigger('click');}
else{if($('#'+$(e.target).data('flap_open')).length){var size='small';if($('#'+$(e.target).data('flap_open')).data('flapsize')){size=$('#'+$(e.target).data('flap_open')).data('flapsize');}
Drupal.flap.showContainer($('#'+$(e.target).data('flap_open')).parent().html(),size);Drupal.attachBehaviors($(Drupal.flap.flap_container+' .block-content').get(0));}}});});$('.bundle--name-pg-table',Drupal.flap.flap_container,context).once('flap-return-click').each(function(){$(this).on("click",function(e){if(!$(e.target).is("a")){var bundleName='.bundle--name-pg-table';e.preventDefault();var link=$(e.target).closest(bundleName).find('.field--field-pg-link a').attr('href');var target=$(e.target).closest(bundleName).find('.field--field-pg-link a').attr('target');if(target==undefined){target="_self";}
if(link!=undefined){if(link!=""){if(e.ctrlKey){window.open(link,'_blank');}else{window.open(link,target);}}else{$(e.target).closest(bundleName).find('.field--field-pg-link a').trigger('click');}}else{$(e.target).closest(bundleName).find('.field--field-pg-link a').trigger('click');}}});});$('.bundle--name-pg-chat',Drupal.flap.flap_container,context).once('flap-return-click').each(function(){$(this).on("click",function(e){if(!$(e.target).is("a")){e.preventDefault();$(this).find('.field--field-pg-link a').trigger('click');}});});$('.flap-return a',Drupal.flap.flap_container,context).once('flap-return-click').each(function(){$(this).on("click",function(e){e.preventDefault();Drupal.flap.popContainer();Drupal.attachBehaviors($(Drupal.flap.flap_container+' .block-content').get(0));Drupal.behaviors.cbrpi_form.updateMainToolbox();});});$(Drupal.flap.flap_close).once('flap-bind-click').each(function(){$(this).on("click",function(e){e.preventDefault();try{tC.event.flap_close(this,{});}
catch(error){console.error(error);}
Drupal.flap.hideContainer();document.dispatchEvent(new CustomEvent('close_flap'));});});$('body').once('flap-document-click').each(function(){$(document).on('click',function(e){if(e.target.className==='smile-customer-overlay'){try{tC.event.flap_close(this,{});}
catch(error){console.error(error);}
Drupal.flap.hideContainer();document.dispatchEvent(new CustomEvent('close_flap'));}});});$('body').once('flap-document-esc').each(function(){$(document).keyup(function(e){if((e.keyCode||e.which)==27){Drupal.flap.hideContainer();document.dispatchEvent(new CustomEvent('close_flap'));}});});$('body').once('flap-window-resize').each(function(){$(window).resize(function(){var mq=window.matchMedia("(min-width: "+Drupal.flap.breakpoint+"px)");if(!mq.matches){Drupal.flap.changeWidthContainer($(window).width());}
else{Drupal.flap.changeWidthContainer($(window).width()-160);}});});},'showContainer':function(block_content,size){this.showOverlay();Drupal.flap.container_flap.push({content:'<div class="block-content">'+block_content+'</div>',size:size});if(Drupal.flap.container_flap.last()!==''){this.addInOverlay(Drupal.flap.container_flap.last());this.animateContainer();}},'popContainer':function(){Drupal.flap.container_flap.pop();if(Drupal.flap.container_flap.last()!==''){this.addInOverlay(Drupal.flap.container_flap.last());}
else{this.hideContainer();}},'addInOverlay':function(container){$(Drupal.flap.flap_container).html(container.content);var dataFlapId=$(container.content).find('article').attr('data-flap-node-id');$(Drupal.flap.flap_container).prepend('<a href="#" class="flap-close"><i class="icon icon-Close"></i></a></div>');if(Drupal.flap.container_flap.length>1){$(Drupal.flap.flap_container).prepend('<div class="flap-return advanced-link sla-base-black slt_link sle_no"><a href="#">Retour</a></div>');}else if(dataFlapId==6014||dataFlapId==6044){$(Drupal.flap.flap_container).prepend('<div class="flap-return access advanced-link sla-base-black slt_link sle_no"><a modal="modal-link" class="flap-open use-ajax" data-flapajaxid="'+drupalSettings.contact_toolbox_id+'" href="/panel/render/'+drupalSettings.contact_toolbox_id+'">Accès aux autres moyens de contact</a></div>');}
$(Drupal.flap.flap_container).removeClass(function(index,className){return(className.match(/(^|\s)flap-size-\S+/g)||[]).join(' ');});$(Drupal.flap.flap_container).addClass('flap-size-'+container.size)},'animateContainer':function(){var mq=window.matchMedia("(min-width: "+Drupal.flap.breakpoint+"px)");var newWidth=$(window).width()-160;if(!mq.matches){newWidth=$(window).width();}
$(Drupal.flap.flap_container).stop(1,1).css({marginRight:0,width:newWidth+'px'});},'hideContainer':function(){this.hideOverlay();if(Drupal.flap.container_flap.last()!==''){$(Drupal.flap.flap_container).stop(1,1).css({"margin-right":"-100%",width:"100%"},{duration:Drupal.flap.animation_delay});}},'showOverlay':function(){if($('.smile-customer-overlay').length===0){$('html').addClass('hideScrollBar');$('body').prepend("<div class='smile-customer-overlay'><div class='block-flap'></div></div>");$(".smile-customer-overlay").fadeIn();}},'hideOverlay':function(){Drupal.flap.container_flap=[];$(".smile-customer-overlay").fadeOut(function(){$('html').removeClass('hideScrollBar');$(this).remove();});},'changeWidthContainer':function(width){if($(Drupal.flap.flap_container).is(":visible")){$(Drupal.flap.flap_container).css('width',width);}}};var getUrlParameter=function getUrlParameter(sParam){var sPageURL=window.location.search.substring(1),sURLVariables=sPageURL.split('&'),sParameterName,i;for(i=0;i<sURLVariables.length;i++){sParameterName=sURLVariables[i].split('=');if(sParameterName[0]===sParam){return sParameterName[1]===undefined?true:sParameterName[1];}}};Drupal.behaviors.flapAutoOpen={attach:function(context,settings){$('body').once('flapAutoOpen').each(function(){var flap=getUrlParameter('volet');if(typeof flap!=='undefined'){$(this).append('<a href="'+flap+'" class="use-ajax d-none" id="flapAutoOpen"></a>');Drupal.ajax.bindAjaxLinks(document.body);$('#flapAutoOpen').trigger('click');}});}};})(jQuery,Drupal,drupalSettings);